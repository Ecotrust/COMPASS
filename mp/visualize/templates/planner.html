<!DOCTYPE html>
{% load url from future %}
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>
            {% if project_name %}
            {{ project_name }}
            {% else %}
            Marine Planner
            {% endif %}
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">
        <!-- Le styles -->
        <link href="{{MEDIA_URL}}/assets/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="{{MEDIA_URL}}/assets/font/font-awesome.css" rel="stylesheet">
        <link href="{{MEDIA_URL}}/css/mp_style.css" rel="stylesheet">
        <link href="{{MEDIA_URL}}/assets/openlayers/scalebar-thin.css" rel="stylesheet">
        <link href="{{MEDIA_URL}}/css/style.css" rel="stylesheet">
        <link href="{{MEDIA_URL}}/css/scenario_form.css" rel="stylesheet">
        <link href="{{MEDIA_URL}}/assets/pageguide/pageguide.css" rel="stylesheet">

        <link href="{{MEDIA_URL}}/assets/smoothness/jquery-ui-1.9.1.custom.css" rel="stylesheet">
        <!-- <link href="{{MEDIA_URL}}/assets/jquery-ui/jquery-ui.min.css" rel="stylesheet"> -->
        <link href="{{MEDIA_URL}}/assets/jquery/jquery.mCustomScrollbar.css" rel="stylesheet">
        <link href="{{MEDIA_URL}}/assets/jquery/jquery.jscrollpane.css" rel="stylesheet">

        <link href="{{MEDIA_URL}}/compass/css/compass_fonts.css" rel="stylesheet">
        <link href="{{MEDIA_URL}}/compass/css/compass.css" rel="stylesheet">

        {% if project_icon %}
        <link rel="shortcut icon" href="{{project_icon}}">
        {% else %}
        <link rel="shortcut icon" href="{{MEDIA_URL}}/ico/favicon.ico">
        {% endif %}

        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
            <link href="{{MEDIA_URL}}/mp/css/mp/mp_style.ie.css" rel="stylesheet">

            <script src="{{MEDIA_URL}}mp/js/respond.min.js"></script>
        <![endif]-->
        <!-- Le fav and touch icons -->
        <!--[if IE 7]>
          <link rel="stylesheet" href="{{MEDIA_URL}}mp/css/font/font-awesome-ie7.css">
        <![endif]-->

        <style>
        .navbar .nav > li:hover > a, .navbar .nav > li.active > a, .navbar .nav > li:hover > a:visited {
            height: 30px;

        }
        .navbar .nav > li > a {
            height: 25px;
        }
        /* don't display g+ login notifications */
        iframe[src*="https://apis.google.com/u/0/_/widget/oauthflow/toast"] {
          display: none;
        }
        </style>

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-55383095-1', 'auto');
          ga('send', 'pageview');
        </script>

        <!-- Check for Mobile Client -->
        <script type="text/javascript">
            // var width = window.innerWidth;
            // if (width < 768) {
                //window.location.href = "/mobile/mobile";
                // window.location.pathname = "/mobile/mobile/";
            // }
        </script>



    </head>

    <body class='ofr'>

        <div class='container'>
          <div class='fullscreen container-row'>
            <div class='container-cell'>
              <div>

                <!-- modals -->
                {% include "modals.html" %}
                {% include "bookmark-modals.html" %}
                <!-- end modals -->

                <!-- TOUR -->
                {% include "tour.html" %}
                <!-- END TOURS -->

                <!-- REGISTRATION MODALS -->
                {% include "account-modals.html" %}
                <!-- SIGN IN MODAL -->

              </div>

              <div id="loading">
                  <h2>Loading...</h2>
                  <div id='spinner'>
                    <button type="button" id="close-spinner" class="close" data-bind="click: function() {$('#loading').hide();}" aria-hidden="true">x</button>
                    <img src="/media/img/ajax-loader.gif"/>
                  </div>
              </div>
              <div class="container-fluid" id="primary-content">
                  <div class="row-fluid loaded-content">
                    <div class="span12">

                      {% load in_group %}
                      <!-- Map Panel (center panel) -->
                      <div id="map-panel" data-bind="visible: showMapPanel, css: {'fullscreen-data': isFullScreen()}">
                        <div id="map-wrapper">
                          <div id="map"></div>
                          <div>
                              <div id="login-buttons">
                                <div>
                                  {% if user.is_authenticated %}
                                  <span class="btn-group">
                                    <a class="btn btn-large dropdown-toggle" data-toggle="dropdown" href="#">
                                      {% if picture %}
                                      <img src="{{picture}}"/>
                                      {% else %}
                                      <i class="icon-user"></i>
                                      {% endif %}
                                      {{user.username}}
                                    </a>
                                    <ul id="username" class="dropdown-menu">
                                      {% if user.is_staff %}
                                      <li><a href="/admin" style="padding-left: 10px"><i class="icon-cogs"></i> Admin</a></li>
                                      {% endif %}
                                      <li><a href="#profile-modal" data-toggle="modal" style="padding-left: 10px"><i class="icon-pencil"></i> Profile</a></li>
                                      <li><a href="#reset-password-modal" data-toggle="modal" style="padding-left: 10px"><i class="icon-lock"></i> Password</a></li>
                                      <li class="divider"></li>
                                      <li><a href="{% url 'user_signout' %}" style="padding-left: 15px"><i class="i"></i>Log Out</a></li>
                                    </ul>
                                  </span>
                                  {% else %}
                                  <span class="btn-group">
                                    <a id="#sign-in-button" class="btn btn-large" href="#sign-in-modal" data-toggle="modal">Admin</a>
                                  </span>
                                  {% endif %}
                                </div>
                              </div>
                              <div id="basemaps" > <!-- Basemaps, Legends, Layers, Bookmarks, and FullScreen buttons -->
                                  <div class="btn-group btn-group-vertical">
                                    <!--Basemaps Button-->
                                    <a id="basemap-button" class="btn" data-bind="click: showBasemaps">
                                        <i class="icon-globe icon-large"></i>
                                        <span>Basemaps</span>
                                    </a>
                                    <!--Hide/Show Legends Button
                                    <a class="btn" data-bind="click: toggleLegend">
                                        <i class="icon-list-ul icon-large"></i>
                                        <span data-bind="text: legendButtonText()"></span>
                                        <span data-bind="visible: hasActiveLegends() > 0"> (<span data-bind="text: activeLegendLayers().length"></span>) </span>
                                    </a>-->
                                    <!--Hide/Show Layers Button-->
                                    <!-- <a class="btn" data-bind="click: toggleLayers">
                                        <i class="icon-list-ul icon-large" data-bind="css: {'icon-indent-right': showLayers(), 'icon-indent-left': ! showLayers()}"></i>
                                        <span data-bind="text: showLayersText()"></span>
                                    </a> -->
                                    <!--Bookmarks Button-->
                                    <a id="bookmarks-button" class="btn" data-bind="click: showBookmarks, visible: !isFullScreen()">
                                        <i class="icon-map-marker icon-large"></i>
                                        <span>Bookmarks</span>
                                        <span data-bind="visible: bookmarks.bookmarksList().length > 0">
                                            (<span data-bind="text: bookmarks.bookmarksList().length"></span>)
                                        </span>
                                    </a>
                                    <!--Map Links Button-->
                                    <a id="basemap-button" class="btn" href="#map-links-modal" data-toggle="modal" data-bind="click: resetMapLinks, visible: !isFullScreen()">
                                        <i class="icon-link icon-large"></i>
                                        <span>Share this Map</span>
                                    </a>
                                    <!-- Print Button -->
                                    <a class="btn" id="btn-print" data-bind="click: printing.showPrintDialog, visible: printing.enabled() && !isFullScreen()">
                                        <i class="icon-print icon-large"></i>
                                        <span>Print/Export</span>
                                    </a>
                                    <!--Fullscreen Button-->
                                    <a class="btn" id="btn-fullscreen">
                                        <i class="icon-fullscreen icon-large"></i>
                                        <span>Fullscreen</span>
                                    </a>
                                  </div>
                              </div>
                              <div id="map-buttons">
                                  <!--
                                  <p><a class="btn pull-right">
                                    Coordinates &amp; Depth
                                  </a></p>
                                  -->
                              </div>

                              <!-- the following container is used to estimate width for the actual Aggregated Attribution Overlay -->
                              <div id="aggregated-attribute-overlay-test" style="position: absolute; visibility: hidden; height: auto; width: auto">
                                  <div data-bind="foreach: attributeLayers()">
                                      <div data-bind="css: {display: $root.aggregatedAttributes()[name] ? 'block' : 'none'}">
                                        <h4 data-bind="text: featureAttributionName"></h4>
                                        <div data-bind="foreach: { data: $root.aggregatedAttributes()[name]}">
                                          <dl data-bind="foreach: { data: $root.aggregatedAttributes()[$parent.name].subLayers, afterAdd:$root.updateMarker }">
                                            <dt>
                                                <!-- <span data-bind="text: display"></span><span data-bind="visible: display && data ? true : data===0">:</span> -->
                                                <span >Lorem ipsum</span><span data-bind="visible:  data ? true : data===0">:</span>
                                                <span style="font-weight: normal" data-bind="text: data"></span>
                                            </dt>
                                          </dl>
                                        </div>
                                      </div>
                                  </div>
                              </div>

                              <!-- Aggregated Attribution Overlay -->

                              <div data-bind="visible: showFeatureAttribution">
                                  <div id="aggregated-attribute-overlay" style="display: none" class="scrollpane" data-bind="visible: aggregatedAttributes, style: {width: aggregatedAttributesWidth}">
                                      <div id="aggregated-attribute-content" class="accordion">
                                          <div data-bind="foreach: attributeLayers()">
                                              <div data-bind="if: $root.aggregatedAttributes()[name]">
                                                  <div class="accordion-group">
                                                      <div class="accordion-heading layer-attr-collapse" data-bind="click: toggleLayerAttribution, attr: { id: $root.convertToSlug(name) + '-header' }">
                                                          <a class="accordion-toggle container-fluid">
                                                            <div class="row-fluid layer-attr-display-ctrl">
                                                              <div class="span1">
                                                                <i class='icon-chevron-down' data-bind="attr: { id: $root.convertToSlug(name) + '-icon' }"></i>
                                                              </div>
                                                              <div class="span11">
                                                                <h4 class="layer-attr-title" data-bind="text: featureAttributionName"></h4>
                                                              </div>
                                                            </div>
                                                            <h5 class="layer-attr-subtitle" data-bind="text: description"></h5>
                                                          </a>
                                                          <div class="btn zoom-to-button" data-bind="click: zoomToFeature">Zoom To</div>
                                                      </div>
                                                      <div class="accordion-body collapse" data-bind="attr: { id: $root.convertToSlug(name) }" >
                                                          <div class="accordion-inner">
                                                            <div data-bind="foreach: { data: $root.aggregatedAttributes()[$data.name], as: '_layer'}">
                                                              <div data-bind="foreach: { data: _layer.subLayers, as: '_sublayer'}">
                                                                <div data-bind="foreach: { data: Object.keys(_sublayer), as: '_key'}">
                                                                  <dl data-bind="foreach: { data: _sublayer[_key], afterAdd:$root.updateMarker }">

                                                                      <dt>
                                                                          <!-- ko if: $data.hasOwnProperty("tab") -->

                                                                          <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>

                                                                          <!-- /ko -->

                                                                          <span data-bind="text: display"></span><span data-bind="visible: display && data ? true : data===0">:</span>
                                                                          <span style="font-weight: normal" data-bind="html: data"></span>
                                                                      </dt>
                                                                  </dl>
                                                                </div>
                                                              </div>
                                                            </div>
                                                          </div>
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                      <span id="close-attribute-overlay" class="pull-right"><a href="#" style="position: absolute; top: 10px; right: 10px; opacity: .6;" class="btn btn-mini close" data-bind="click: closeAttribution"> x </a> </span>
                                  </div>
                              </div>

                              <!-- Bookmark Message -->
                              <div id="error-overlay" data-bind="visible: error() === 'restoreState'" style="display:none">
                                  <div>
                                      <span class="pull-right">
                                          <a href="#" style="margin-left: 10px; opacity: .6;" class="close btn btn-mini" data-bind="click: closeAlert"> x </a>
                                          <a class="btn btn-mini" data-bind="click: bookmarks.restoreState">
                                              Return to Previous View
                                          </a>
                                      </span>
                                      <span data-bind="text: bookmarks.activeBookmark"></span>
                                      <div class="clearfix"></div>
                                  </div>
                              </div>

                              <!-- FullScreen Fail Message -->
                              <div id="fullscreen-error-overlay" style="display:none">
                                  <div>
                                      <span class="pull-right">
                                          <a href="#" style="margin-left: 10px; opacity: .6;" class="close btn btn-mini" data-bind="click: closeAlert"> x </a>

                                      </span>
                                      <span>We're sorry, the Fullscreen option is not supported in all browsers at this time...If it's important, you might try Firefox or Chrome.</span>
                                  </div>
                              </div>

                            <!-- Description Overlay  style="display:none"-->
                              <div id ="description-overlay" class="row-fluid" style="display: none" data-bind="visible: showDescription() && !showOverview()" >
                                  <div class="span11">
                                      <span class="title" data-bind="text: activeInfoLayer().name"></span> --
                                      <span class="text" data-bind="text: activeInfoLayer().description"></span>
                                      <div class="pull-right"><a class="btn btn-mini" data-bind="click: expandDescription, text: 'Show More...'"></a></div>
                                  </div>
                                  <div class="span1">
                                      <a href="#" style="margin-left: 10px; opacity: .6;" class="btn btn-mini pull-right close" data-bind="click: closeDescription"> x </a>
                                  </div>
                              </div>

                              <div id="overview-overlay" class="row-fluid" style="display: none" data-bind="visible: showOverview()" >
                                  <div id="overview-overlay-content" class="span12">
                                      <div id="overview-overlay-header" >
                                          <span class="btn-group" data-bind="visible: activeInfoLayer() && activeInfoLayer().subLayers && activeInfoLayer().subLayers.length !== 0">
                                              <a id="overview-dropdown-button" class="btn dropdown-toggle" href="#" name="description-dropdown" data-bind="click: activateOverviewDropdown">
                                                  <span data-bind="text: activeInfoSublayer().name ? activeInfoSublayer().name : activeInfoLayer().name"></span>
                                                  <span class="caret"></span>
                                              </a>
                                              <ul id="overview-overlay-dropdown" class="dropdown-menu">
                                                  <li>
                                                      <a data-bind="click: activeInfoLayer().toggleSublayerDescription">
                                                          <span data-bind="text: activeInfoLayer().name"></span>
                                                      </a>
                                                  </li>
                                                  <li data-bind="foreach: activeInfoLayer().subLayers">
                                                      <a data-bind="click: toggleSublayerDescription">
                                                          <span data-bind="text: name"></span>
                                                      </a>
                                                  </li>
                                              </ul>
                                          </span>
                                          <div style="width: 90%;overflow: hidden;text-overflow: ellipsis;">
                                              <span style="white-space: nowrap" class="title" data-bind="text: activeInfoLayer().name, visible: activeInfoLayer() && (!activeInfoLayer().subLayers || activeInfoLayer().subLayers.length == 0)"></span>
                                          </div>
                                          <span style="position: absolute; top: 8px; right: 8px"><a href="#" style="margin-left: 10px; opacity: .8;" class="btn btn-mini pull-right close" data-bind="click: closeDescription"> x </a> </span>
                                      </div>
                                      <div id="overview-overlay-text" style="margin-top: 5px">
                                          <span class="text" data-bind="text: getOverviewText()" style="white-space: pre-wrap"></span>
                                          <div class="notes">
                                              <div data-bind="visible: activeInfoSublayer() ? activeInfoSublayer().data_source : activeInfoLayer().data_source">
                                                  Source:
                                                  <span data-bind="text: activeInfoSublayer() ? activeInfoSublayer().data_source : activeInfoLayer().data_source"></span>
                                              </div>
                                              <div style="margin-top: 5px" data-bind="visible: activeInfoSublayer() ? activeInfoSublayer().data_notes : activeInfoLayer().data_notes">
                                                  Notes:
                                                  <span data-bind="text: activeInfoSublayer() ? activeInfoSublayer().data_notes : activeInfoLayer().data_notes"></span>
                                              </div>
                                          </div>
                                      </div>

                                      <div id="overview-overlay-links">
                                        <span class="span12">
                                          <div class="text" style="margin-top: 5px">
                                              <span>
                                                  <a class="btn btn-mini" data-bind="css: { disabled: ! activeDataLink() }, attr: { href: activeDataLink() }" target="_blank">
                                                      <span rel="tooltip" title="Download ESRI Formatted Dataset">
                                                          DATA
                                                      </span>
                                                  </a>
                                              </span>
                                              <span>
                                                  <a class="btn btn-mini" data-bind="css: { disabled: ! activeMetadataLink() }, attr: { href: activeMetadataLink() }" target="_blank">
                                                      <span rel="tooltip" title="View the Metadata">
                                                          METADATA
                                                      </span>
                                                  </a>
                                              </span>
                                              <span>
                                                  <a class="btn btn-mini" data-bind="css: { disabled: ! activeSourceLink() }, attr: { href: activeSourceLink() }" target="_blank">
                                                      <span rel="tooltip" title="Link to Dataset Source Provider">
                                                          SOURCE
                                                      </span>
                                                  </a>
                                              </span>
                                              <span>
                                                  <a class="btn btn-mini" data-bind="css: { disabled: ! activeTilesLink() }, attr: { href: activeTilesLink() }" target="_blank">
                                                      <span rel="tooltip" title="Web Mapping Services">
                                                          WMS
                                                      </span>
                                                  </a>
                                              </span>
                                              <span>
                                                  <a class="btn btn-mini" data-bind="style: { visibility: ((! activeOCSLink()) ? 'hidden' : 'visible') }, attr: { href: activeOCSLink() }" target="_blank">
                                                      <span rel="tooltip" title="View in Oregon Conservation Strategy">
                                                          OCS
                                                      </span>
                                                  </a>
                                              </span>
                                          </div>
                                        </span>
                                      </div>
                                  </div>
                              </div>

                          </div>
                        </div>
                      </div>

                      <!-- Data Panel (left panel) -->
                      <div data-bind="visible: showLayers()">
                      <div class="tabs">
                          <div class="sidebar-nav" data-bind="css: {'fullscreen-data': isFullScreen()}">

                              <!-- Header -->
                              <div id="data-panel-header">
                                  <div class="row-fluid header">
                                      <div class="span12 brand">
                                          {% if project_home_page %}
                                          <a href="{{project_home_page}}" style="text-decoration: none" target="_blank">
                                          {% else %}
                                          <a style="text-decoration: none; cursor: default;">
                                          {% endif %}
                                              {% if project_logo %}
                                              <img id="project-logo" src="{{project_logo}}"/>
                                              {% else %}
                                                  {% if project_name %}
                                                  <h2 id="project-name-header">{{project_name}}</h2>
                                                  {% else %}
                                                  <h2 id="project-name-header">Marine Planner</h2>
                                                  {% endif %}
                                              {% endif %}
                                          </a>
                                          <h3 class="pull-right" data-bind="visible: mapTitle, text: mapTitle"></h3>
                                      </div>
                                      <div id="compass-footer" data-bind="visible: showBottomButtons()">
                                          <span class="btn-group">
                                            <a id="help-button" class="btn" href="#help-modal" data-toggle="modal">Tutorial</a>
                                            <div id="data-panel-footer" class="row-fluid footer">
                                              <a href="http://www.dfw.state.or.us/maps/compass/" target="_blank">
                                                <img class="span12" src="/media/compass/img/CompassAndODFW_BW_green.png" />
                                              </a>
                                            </div>
                                          </span>
                                      </div>
                                  </div>
                              </div>


                              <!-- tab controls -->
                              <ul id="myTab" class="nav nav-tabs" style="padding-top: 8px; margin-left: 2px; margin-bottom: 0px;">
                                  <li class="active" data-tab="data">
                                      <a href="#data" data-toggle="tab" id="dataTab">Data</a>
                                  </li>
                                  <li data-tab="active" >
                                      <a href="#active" data-toggle="tab" id="activeTab">Active</a>
                                  </li>
                                  <li data-tab="legend" >
                                      <a href="#legend" data-toggle="tab" id="legendTab">Legend</a>
                                  </li>

                              </ul>

                              <!-- tab body -->
                              <div id="myTabContent" class="tab-content">

                                  <!-- DATA TAB -->
                                  <div class="tab-pane active in fade" id="data" style="height: 100%">
                                      <!-- Search -->
                                      <div class="row-fluid search-bar-row" >
                                          <div class="search-form span12">
                                              <form class="form-search" data-bind="submit: layerSearch" style="margin-left: auto; margin-right: auto; width: 80%; height: 0px">
                                                  <div class="span12" style="float: none;">
                                                      <span style="border-radius: 4px;">
                                                        <input type="search" class="field search-box" data-provide="typeahead" data-bind="value: searchTerm, event: { keyup: keySearch }" name="s" id="s" placeholder="Search Data" style="border-radius: 4px;">
                                                      </span>
                                                      <input type="submit" class="search" name="submit" id="searchsubmit" value="Search" style="background: url(http://ourfloridareefs.org/wp-content/themes/OurFloridaReefs/images/search.png) no-repeat 0 0; width: 26px; height: 30px; border: none; padding: 0; cursor: pointer; font-size: 0; margin-top: 9px; border-radius: 0px">
                                                      <!-- <input type="text" class="search-box" data-provide="typeahead" data-bind="value: searchTerm, event: { keyup: keySearch }" style="overflow: hidden; text-overflow: ellipsis; width: 80%;" placeholder="Search">
                                                      <a class="btn">
                                                          <i class="icon-remove icon-large"></i>
                                                      </a> -->
                                                  </div>
                                              </form>
                                          </div>
                                      </div>
                                      <div class="row-fluid" style="height: 100%;">
                                          <div class="span12 accordion-wrapper" style="height: 100%;">
                                              <!-- data accordion -->
                                              <div id="data-accordion" style="max-height: 100%;">
                                                  <div class="accordion" data-bind="foreach: themes">
                                                      <div class="accordion-group">
                                                          <div class="accordion-heading" data-bind="click: setOpenTheme, css: { 'active': isOpenTheme() }">
                                                              <div>
                                                                  <a class="accordion-toggle"> <!--event: {'hover': showDescription}-->
                                                                      <span data-bind="text: name">Themes</span></a>
                                                              </div>
                                                          </div>
                                                          <div class="accordion-body collapse" data-bind="css: { 'in': isOpenTheme() }">
                                                              <div class="accordion-inner">
                                                                <ul  class="unstyled" data-bind="foreach: layers ">
                                                                    <li class="layer" data-bind="css: { nosublayers: subLayers.length === 0 }">
                                                                        <div class="btn-group btn-group-layer" data-bind="css: {'open': showSublayers() }, attr: {name: name}">
                                                                            <a class="btn btn-info-sign" data-bind="click: toggleDescription, css: { 'active': infoActive() }">
                                                                                <i class="icon-info-sign icon-large"></i>
                                                                            </a>

                                                                            <a class="btn btn-layer" data-bind="css: { 'active': active(), 'not-active': ! active() }, click: toggleActive">
                                                                                <div style="font-weight: normal">
                                                                                    <span style="padding-left: 5px;" data-bind="text: name"></span>
                                                                                    <span class="caret" style="display:none" data-bind="visible: subLayers.length > 0"></span>
                                                                                    <i class="check icon-large icon-check" data-bind="visible: active() && visible()"></i>
                                                                                    <i class="check icon-large icon-check-empty" data-bind="visible: active() && ! visible()"></i>
                                                                                </div>
                                                                            </a>
                                                                            <!-- ko if: subLayers.length > 0 -->
                                                                            <!-- ko if: !isCheckBoxLayer() -->
                                                                            <ul class="dropdown-menu layer-menu" data-bind="event: { mouseleave: closeMenu }">
                                                                                <li data-bind="foreach: subLayers">
                                                                                    <a data-bind="click: toggleActive">
                                                                                        <!--<span data-bind="style: {visibility: active() ? 'visible': 'hidden' }">• </span>-->
                                                                                        <!--<span style="margin-left: -10px" data-bind="style: {visibility: active() ? 'visible': 'hidden' }">
                                                                                            <i class="icon-ok-circle"></i>
                                                                                        </span>-->
                                                                                        <i class="icon-ok" data-bind="style: {visibility: active() ? 'visible': 'hidden' }"></i>
                                                                                        <span data-bind="text: name"></span>
                                                                                    </a>
                                                                                </li>
                                                                            </ul>
                                                                            <!-- /ko -->
                                                                            <!-- ko if: isCheckBoxLayer() -->
                                                                            <ul class="dropdown-menu layer-menu" data-bind="event: { mouseleave: closeMenu }">
                                                                                <li data-bind="foreach: subLayers">
                                                                                    <a data-bind="click: toggleActive" style="padding-left: 15px;">
                                                                                        <span style="margin-left: -10px">
                                                                                            <i class="icon-check" data-bind="style: {display: active() ? 'inline': 'none' }"></i>
                                                                                            <i style="opacity: .4" class="icon-check-empty" data-bind="style: {display: ! active() ? 'inline': 'none' }"></i>
                                                                                        </span>
                                                                                        <span data-bind="text: name"></span>
                                                                                    </a>
                                                                                </li>
                                                                            </ul>
                                                                            <!-- /ko -->
                                                                            <!-- /ko -->
                                                                            <div data-bind="attr: {id: id + '_overview' }" class="row-fluid overview-accordion collapse">
                                                                                <div class="span11  well overview-accordion-content">
                                                                                    <div class="overview-accordion-text" style="margin-top: 5px">
                                                                                        <span class="text" data-bind="text: description" style="white-space: pre-wrap"></span>
                                                                                        <div class="notes">
                                                                                            <div data-bind="visible: data_source">
                                                                                                Source:
                                                                                                <span data-bind="text: data_source"></span>
                                                                                            </div>
                                                                                            <div style="margin-top: 5px" data-bind="visible: data_notes">
                                                                                                Notes:
                                                                                                <span data-bind="text: data_notes"></span>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="overview-accordion-links">
                                                                                      <span class="span12">
                                                                                        <div class="text" style="margin-top: 5px">
                                                                                            <span>
                                                                                                <a class="btn btn-mini" data-bind="css: { disabled: (data_download == '' || data_download == null) }, attr: { href: data_download }" target="_blank">
                                                                                                    <span rel="tooltip" title="Download ESRI Formatted Dataset">
                                                                                                        DATA
                                                                                                    </span>
                                                                                                </a>
                                                                                            </span>
                                                                                            <span>
                                                                                                <a class="btn btn-mini" data-bind="css: { disabled: (metadata == '' || metadata == null) }, attr: { href: metadata }" target="_blank">
                                                                                                    <span rel="tooltip" title="View the Metadata">
                                                                                                        METADATA
                                                                                                    </span>
                                                                                                </a>
                                                                                            </span>
                                                                                            <span>
                                                                                                <a class="btn btn-mini" data-bind="css: { disabled: (source == '' || source == null) }, attr: { href: source }" target="_blank">
                                                                                                    <span rel="tooltip" title="Link to Dataset Source Provider">
                                                                                                        SOURCE
                                                                                                    </span>
                                                                                                </a>
                                                                                            </span>
                                                                                            <span>
                                                                                                <a class="btn btn-mini" data-bind="css: { disabled: (tiles == '' || tiles == null) }, attr: { href: tiles }" target="_blank">
                                                                                                    <span rel="tooltip" title="Web Mapping Services">
                                                                                                        WMS
                                                                                                    </span>
                                                                                                </a>
                                                                                            </span>
                                                                                            <span>
                                                                                                <a class="btn btn-mini" data-bind="style: { visibility: ((ocs == '' || ocs == null) ? 'hidden' : 'visible') }, attr: { href: ocs }" target="_blank">
                                                                                                    <span rel="tooltip" title="View in Oregon Conservation Strategy">
                                                                                                        OCS
                                                                                                    </span>
                                                                                                </a>
                                                                                            </span>
                                                                                        </div>
                                                                                      </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                </ul>


                                                                  <div class="accordion" data-bind="foreach: subthemes">
                                                                      <div class="accordion-group">
                                                                          <div class="accordion-heading subcategory-heading" data-bind="click: setOpenSubTheme, css:{ 'active': isOpenSubTheme() }">
                                                                              <div>
                                                                                  <a class="accordion-toggle">
                                                                                      <span data-bind="text: name">Subcategory</span>
                                                                                  </a>
                                                                              </div>
                                                                          </div>
                                                                          <div class="accordion-botdy collapse" data-bind="css: { 'in': isOpenSubTheme() }">



                                                                              <ul  class="unstyled" data-bind="foreach: layers ">
                                                                                  <li class="layer" data-bind="css: { nosublayers: subLayers.length === 0 }">
                                                                                      <div class="btn-group btn-group-layer" data-bind="css: {'open': showSublayers() }, attr: {name: name}">
                                                                                          <a class="btn btn-info-sign" data-bind="click: toggleDescription, css: { 'active': infoActive() }">
                                                                                              <i class="icon-info-sign icon-large"></i>
                                                                                          </a>

                                                                                          <a class="btn btn-layer" data-bind="css: { 'active': active(), 'not-active': ! active() }, click: toggleActive">
                                                                                              <div style="font-weight: normal">
                                                                                                  <span style="padding-left: 5px;" data-bind="text: name"></span>
                                                                                                  <span class="caret" style="display:none" data-bind="visible: subLayers.length > 0"></span>
                                                                                                  <i class="check icon-large icon-check" data-bind="visible: active() && visible()"></i>
                                                                                                  <i class="check icon-large icon-check-empty" data-bind="visible: active() && ! visible()"></i>
                                                                                              </div>
                                                                                          </a>
                                                                                          <!-- ko if: subLayers.length > 0 -->
                                                                                          <!-- ko if: !isCheckBoxLayer() -->
                                                                                          <ul class="dropdown-menu layer-menu" data-bind="event: { mouseleave: closeMenu }">
                                                                                              <li data-bind="foreach: subLayers">
                                                                                                  <a data-bind="click: toggleActive">
                                                                                                      <!--<span data-bind="style: {visibility: active() ? 'visible': 'hidden' }">• </span>-->
                                                                                                      <!--<span style="margin-left: -10px" data-bind="style: {visibility: active() ? 'visible': 'hidden' }">
                                                                                                          <i class="icon-ok-circle"></i>
                                                                                                      </span>-->
                                                                                                      <i class="icon-ok" data-bind="style: {visibility: active() ? 'visible': 'hidden' }"></i>
                                                                                                      <span data-bind="text: name"></span>
                                                                                                  </a>
                                                                                              </li>
                                                                                          </ul>
                                                                                          <!-- /ko -->
                                                                                          <!-- ko if: isCheckBoxLayer() -->
                                                                                          <ul class="dropdown-menu layer-menu" data-bind="event: { mouseleave: closeMenu }">
                                                                                              <li data-bind="foreach: subLayers">
                                                                                                  <a data-bind="click: toggleActive" style="padding-left: 15px;">
                                                                                                      <span style="margin-left: -10px">
                                                                                                          <i class="icon-check" data-bind="style: {display: active() ? 'inline': 'none' }"></i>
                                                                                                          <i style="opacity: .4" class="icon-check-empty" data-bind="style: {display: ! active() ? 'inline': 'none' }"></i>
                                                                                                      </span>
                                                                                                      <span data-bind="text: name"></span>
                                                                                                  </a>
                                                                                              </li>
                                                                                          </ul>
                                                                                          <!-- /ko -->
                                                                                          <!-- /ko -->


                                                                                          <div data-bind="attr: {id: id + '_overview' }" class="row-fluid overview-accordion collapse">
                                                                                              <div class="span11 well overview-accordion-content">
                                                                                                  <div class="overview-accordion-text" style="margin-top: 5px">
                                                                                                      <span class="text" data-bind="text: description" style="white-space: pre-wrap"></span>
                                                                                                      <div class="notes">
                                                                                                          <div data-bind="visible: data_source">
                                                                                                              Source:
                                                                                                              <span data-bind="text: data_source"></span>
                                                                                                          </div>
                                                                                                          <div style="margin-top: 5px" data-bind="visible: data_notes">
                                                                                                              Notes:
                                                                                                              <span data-bind="text: data_notes"></span>
                                                                                                          </div>
                                                                                                      </div>
                                                                                                  </div>

                                                                                                  <div class="overview-accordion-links">
                                                                                                    <span class="span12">
                                                                                                      <div class="text" style="margin-top: 5px">
                                                                                                          <span>
                                                                                                              <a class="btn btn-mini" data-bind="css: { disabled: (data_download == '' || data_download == null) }, attr: { href: data_download }" target="_blank">
                                                                                                                  <span rel="tooltip" title="Download ESRI Formatted Dataset">
                                                                                                                      DATA
                                                                                                                  </span>
                                                                                                              </a>
                                                                                                          </span>
                                                                                                          <span>
                                                                                                              <a class="btn btn-mini" data-bind="css: { disabled: (metadata == '' || metadata == null) }, attr: { href: metadata }" target="_blank">
                                                                                                                  <span rel="tooltip" title="View the Metadata">
                                                                                                                      METADATA
                                                                                                                  </span>
                                                                                                              </a>
                                                                                                          </span>
                                                                                                          <span>
                                                                                                              <a class="btn btn-mini" data-bind="css: { disabled: (source == '' || source == null) }, attr: { href: source }" target="_blank">
                                                                                                                  <span rel="tooltip" title="Link to Dataset Source Provider">
                                                                                                                      SOURCE
                                                                                                                  </span>
                                                                                                              </a>
                                                                                                          </span>
                                                                                                          <span>
                                                                                                              <a class="btn btn-mini" data-bind="css: { disabled: (tiles == '' || tiles == null) }, attr: { href: tiles }" target="_blank">
                                                                                                                  <span rel="tooltip" title="Web Mapping Services">
                                                                                                                      WMS
                                                                                                                  </span>
                                                                                                              </a>
                                                                                                          </span>
                                                                                                          <span>
                                                                                                              <a class="btn btn-mini" data-bind="style: { visibility: ((ocs == '' || ocs == null) ? 'hidden' : 'visible') }, attr: { href: ocs }" target="_blank">
                                                                                                                  <span rel="tooltip" title="View in Oregon Conservation Strategy">
                                                                                                                      OCS
                                                                                                                  </span>
                                                                                                              </a>
                                                                                                          </span>
                                                                                                      </div>
                                                                                                    </span>
                                                                                                  </div>
                                                                                              </div>
                                                                                          </div>







                                                                                      </div>
                                                                                  </li>
                                                                              </ul>



                                                                          </div>
                                                                      </div>
                                                                  </div>

                                                              </div>
                                                          </div>
                                                      </div>
                                                  </div>
                                              </div>
                                              <!-- /data-accordion -->
                                          </div>
                                      </div>
                                  </div>
                                  <!-- END DATA TAB -->

                                  <!-- ACTIVE TAB -->
                                  <div class="tab-pane fade" id="active">
                                      <div class="row-fluid" style="height: 100%">
                                          <div id="active-content" class="span12" style="height: 100%;">
                                              <div data-bind="visible: activeLayers().length === 0">
                                                  <div style="margin: 20px;">
                                                      <p>
                                                          You currently have no activated data layers.
                                                      </p>
                                                      <p>
                                                          Data layers that are activated in the Data panel will appear in this Active panel.
                                                      </p>
                                                      <p>
                                                          Data layers in the Active panel can be adjusted in terms of their transparency and their ordering on the map.
                                                      </p>
                                                  </div>
                                              </div>
                                              <ul class="unstyled list" style="margin: 0px 5px 20px;" data-bind="sortable: { data: activeLayers, options: {  } }">
                                                  <li>
                                                      <div class="btn-group">
                                                          <button class="btn btn-info-sign" data-bind="click: toggleActiveDescription, css: { 'active': infoActive()}, visible: isLayerModel()"><i class="icon-info-sign icon-large"></i></button>
                                                          <a class="btn btn-layer" data-bind="css: { 'active': visible(), 'design-layer': !isLayerModel() }, click: toggleVisible">
                                                              <div data-bind="text: name"></div>
                                                              <span rel="tooltip" data-bind="attr: {title: sharedBy}">
                                                                  <i class="icon-group" data-bind="visible: shared" style="padding-left: 10px"></i>
                                                              </span>
                                                              <span ><i class="icon-large check" data-bind="css: { 'icon-check': visible(), 'icon-check-empty': ! visible() }"></i></span>
                                                          </a>
                                                          <a class="btn opacity-button" data-bind="click: $parent.showOpacity"><i class="icon-adjust icon-large"></i></a>
                                                          <button class="btn deactivate-button" data-bind="click: toggleActive">
                                                              <i class="icon-remove">
                                                              </i>
                                                          </button>
                                                      </div>
                                                      <div data-bind="attr: {id: id + '_overview_active' }" class="row-fluid overview-accordion collapse accordion-body">
                                                          <div class="span11  well overview-accordion-content">
                                                              <div class="overview-accordion-text" style="margin-top: 5px">
                                                                  <span class="text" data-bind="text: description" style="white-space: pre-wrap"></span>
                                                                  <div class="notes">
                                                                      <div data-bind="visible: data_source">
                                                                          Source:
                                                                          <span data-bind="text: data_source"></span>
                                                                      </div>
                                                                      <div style="margin-top: 5px" data-bind="visible: data_notes">
                                                                          Notes:
                                                                          <span data-bind="text: data_notes"></span>
                                                                      </div>
                                                                  </div>
                                                              </div>

                                                              <div class="overview-accordion-links">
                                                                <span class="span12">
                                                                  <div class="text" style="margin-top: 5px">
                                                                      <span>
                                                                          <a class="btn btn-mini" data-bind="css: { disabled: (data_download == '' || data_download == null) }, attr: { href: data_download }" target="_blank">
                                                                              <span rel="tooltip" title="Download ESRI Formatted Dataset">
                                                                                  DATA
                                                                              </span>
                                                                          </a>
                                                                      </span>
                                                                      <span>
                                                                          <a class="btn btn-mini" data-bind="css: { disabled: (metadata == '' || metadata == null) }, attr: { href: metadata }" target="_blank">
                                                                              <span rel="tooltip" title="View the Metadata">
                                                                                  METADATA
                                                                              </span>
                                                                          </a>
                                                                      </span>
                                                                      <span>
                                                                          <a class="btn btn-mini" data-bind="css: { disabled: (source == '' || source == null) }, attr: { href: source }" target="_blank">
                                                                              <span rel="tooltip" title="Link to Dataset Source Provider">
                                                                                  SOURCE
                                                                              </span>
                                                                          </a>
                                                                      </span>
                                                                      <span>
                                                                          <a class="btn btn-mini" data-bind="css: { disabled: (tiles == '' || tiles == null) }, attr: { href: tiles }" target="_blank">
                                                                              <span rel="tooltip" title="Web Mapping Services">
                                                                                  WMS
                                                                              </span>
                                                                          </a>
                                                                      </span>
                                                                      <span>
                                                                          <a class="btn btn-mini" data-bind="style: { visibility: ((ocs == '' || ocs == null) ? 'hidden' : 'visible') }, attr: { href: ocs }" target="_blank">
                                                                              <span rel="tooltip" title="View in Oregon Conservation Strategy">
                                                                                  OCS
                                                                              </span>
                                                                          </a>
                                                                      </span>
                                                                  </div>
                                                                </span>
                                                              </div>
                                                          </div>
                                                      </div>

                                                  </li>
                                              </ul>
                                          </div>
                                      </div>
                                  </div>
                                  <!-- END ACTIVE TAB -->

                                  <!-- LEGEND TAB -->
                                  <div class="tab-pane fade" id="legend">
                                      <div class="row-fluid" style="height: 100%">

                                          <div id="legend-content" class="accordion">
                                            <div data-bind="visible: activeLegendLayers().length == 0">
                                              Activate data layers and their legends will appear here in the Legend tab.
                                            </div>
                                            <div data-bind="foreach: activeLegendLayers">
                                              <div class="accordion-group" style="border: 0px;">
                                                  <div class="accordion-heading" data-bind="click: toggleLegendDetails">
                                                      <a class="accordion-toggle" style="text-decoration: none; padding-left: 0px;">
                                                          <span class="pagination-centered legend-title" data-bind="html: legendTitle ? legendTitle : name"></span>
                                                          <p style="margin: 0px -5px 3px; text-align: left;font-size: 12px;" data-bind="visible: legendSubTitle, html: legendSubTitle"></p>
                                                      </a>
                                                  </div>
                                                  <div class="accordion-body collapse in" data-bind="attr: { id: $root.convertToSlug(name)+'-legend-content' }" >
                                                      <div class="accordion-inner" style="border: 0px; padding-top: 0px;">
                                                          <span data-bind="if: legend">
                                                              <div data-bind="if: legend['layers']">
                                                                  <div data-bind="foreach: legend['layers']" class="legendLayer">
                                                                      <span data-bind="text: layer['title']" style="font-size: 13px; font-weight: bold;"></span>
                                                                      <div data-bind="if: layer['elements']">
                                                                          <div data-bind="foreach: layer['elements']" class="legendLayerElement">
                                                                              <div>
                                                                                  <img data-bind="attr: {src: swatch}" />
                                                                                  <span data-bind="text: label" style="font-size: 11px; font-weight: bold;"></span>
                                                                              </div>
                                                                          </div>
                                                                      </div>
                                                                      <div data-bind="if: layer['colors']">
                                                                          <div data-bind="foreach: layer['colors']">
                                                                              <div>
                                                                                  <svg style="width: 150px; height: 15px;">
                                                                                      <rect width="15" height="15" data-bind="style: { fill: color }"></rect>
                                                                                      <text x="25" y="12" style="font-size: 11px; fill: #555;" data-bind="text: label">
                                                                                  </svg>
                                                                                  <!-- <span data-bind="text: label" style="font-size: 11px; margin-left: 5px"></span> -->
                                                                              </div>
                                                                          </div>
                                                                      </div>
                                                                  </div>
                                                              </div>
                                                              <div data-bind="if: legend['elements']">
                                                                  <div data-bind="foreach: legend['elements']">
                                                                      <div>
                                                                          <img data-bind="attr: {src: swatch}" />
                                                                          <span data-bind="text: label" style="font-size: 11px; font-weight: bold;"></span>
                                                                      </div>
                                                                  </div>
                                                              </div>
                                                              <div data-bind="if: legend['colors']">
                                                                  <div data-bind="foreach: legend['colors']">
                                                                      <div>
                                                                          <svg style="width: 150px; height: 15px;">
                                                                              <rect width="15" height="15" data-bind="style: { fill: color }"></rect>
                                                                              <text x="25" y="12" style="font-size: 11px; fill: #555;" data-bind="text: label">
                                                                          </svg>
                                                                          <!-- <span data-bind="text: label" style="font-size: 11px; margin-left: 5px"></span> -->
                                                                      </div>
                                                                  </div>
                                                              </div>
                                                              <div data-bind="if: !legend['elements'] && !legend['colors'] && !legend['layers']">
                                                                  <div data-bind="css: { 'in': legendVisibility }" style="padding-top: 5px;">
                                                                      <img data-bind="attr: { src: legend }" />
                                                                  </div>
                                                              </div>
                                                          </span>
                                                      </div>
                                                  </div>
                                              </div>
                                            </div>
                                          </div>

                                      </div>
                                  </div>
                                  <!-- END LEGEND TAB -->

                              </div>
                          </div>
                      </div>
                      <!-- /Data Panel -->

                      <div id="compass-search-header">
                        <div class="row-fluid">
                          <form data-bind="submit: geosearch" class="span8 search-wrap">
                            <div class='row-fluid'>
                              <div class="span9">
                                <input type="search" placeholder="Search the Map" id="geosearch-field" class="search-field" name="geoquery" value="">
                              </div>
                              <div class="span3 search-btn-wrapper">
                                <button class="search-submit btn btn-default" type="submit">Search</button>
                              </div>
                            </div>
                          </form>
                        </div>
                      </div>

                      </div>
                    </div>
                  </div>

                  <span class="timestamp" data-bind="visible: mapTitle"><span data-bind="text: new Date().toString('M/d/yyyy HH:mm')"></span></span>
              </div>
              <div>

                <!-- transparency tool -->
                <div style="display:none" id="opacity-popover" class="popover fade bottom in">
                    <div class="arrow">
                    </div>
                    <div class="popover-inner">
                        <div class="popover-content" data-bind="if: selectedLayer">
                            <div class="slider" data-bind="jqSlider: selectedLayer().opacity, jqOptions: { min: 0, max: 1, step: .01, range: 'min' }"></div>
                        </div>
                    </div>
                </div>

                {% include "bookmarks.html" %}

                {% include "printing.html" %}
                {% if not user.is_authenticated %}
                <form id="google-plus" method="post" action="{% url 'social:complete' "google-plus" %}">{% csrf_token %}
                    <input id="at" type="hidden" name="access_token" value="" />
                    <input id="code" type="hidden" name="code" value="" />
                </form>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="footer container-row">
            <!-- tab for collapse toggle -->
            <div class="container-cell" id="legend-bottom-wrapper" data-bind="visible: activeLegendLayers().length != 0">
              <div class="row-fluid">
                <div class="span2 offset5">
                  <ul class="nav nav-tabs" id="legendTab">
                    <li><a href="#bottom-legend" data-toggle="tab">Legend<i class="icon-chevron-up"></i></a></li>
                  <ul>
                  <div class="tab-content">
                    <div class="tab-pane" id="bottom-legend">
                    </div>
                  </div>
                </div>
              </div>
              <div id="legend-bottom" style="display: none;">
                <div id='legend-bottom-contents'>
                  <div data-bind="foreach: activeLegendLayers">
                    <div class="legend-group">
                        <div class="legend-heading">
                            <a class="legend-toggle">
                                <span class="pagination-centered legend-title" data-bind="html: legendTitle ? legendTitle : name"></span>
                                <p class='legend-subtitle' data-bind="visible: legendSubTitle, html: legendSubTitle"></p>
                            </a>
                        </div>
                        <div class="legend-body collapse in" data-bind="attr: { id: $root.convertToSlug(name)+'-legend-content' }" >
                            <div class="legend-inner">
                                <span data-bind="if: legend">
                                    <div data-bind="if: legend['layers']">
                                        <div data-bind="foreach: legend['layers']" class="legendLayer">
                                            <span class='legend-layer-title' data-bind="text: layer['title']"></span>
                                            <div data-bind="if: layer['elements']">
                                                <div data-bind="foreach: layer['elements']" class="legendLayerElement">
                                                    <div>
                                                        <img data-bind="attr: {src: swatch}" />
                                                        <span class="legend-layer-label" data-bind="text: label"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div data-bind="if: layer['colors']">
                                                <div data-bind="foreach: layer['colors']">
                                                    <div>
                                                        <svg class="legend-svg">
                                                            <rect width="15" height="15" data-bind="style: { fill: color }"></rect>
                                                            <text x="25" y="12" class="legend-svg-text" data-bind="text: label">
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div data-bind="if: legend['elements']">
                                        <div data-bind="foreach: legend['elements']">
                                            <div>
                                                <img data-bind="attr: {src: swatch}" />
                                                <span data-bind="text: label" class="legend-layer-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div data-bind="if: legend['colors']">
                                        <div data-bind="foreach: legend['colors']">
                                            <div>
                                                <svg class="legend-svg">
                                                    <rect width="15" height="15" data-bind="style: { fill: color }"></rect>
                                                    <text x="25" y="12" class="legend-svg-text" data-bind="text: label">
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div data-bind="if: !legend['elements'] && !legend['colors'] && !legend['layers']">
                                        <div data-bind="css: { 'in': legendVisibility }" class="legend-element">
                                            <img data-bind="attr: { src: legend }" />
                                        </div>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Le javascript -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="{{MEDIA_URL}}/assets/jquery/jquery.js"></script>
        <script src="{{MEDIA_URL}}/assets/bootstrap/bootstrap.min.js"></script>
        <script src="{{MEDIA_URL}}/assets/amplify/amplify.min.js"></script>
        <script src="{{MEDIA_URL}}/assets/jquery/jquery.ba-bbq.js"></script>
        <!-- <script src="{{MEDIA_URL}}/assets/jquery/jquery-ui-1.9.1.custom.js"></script> -->
        <script src="{{MEDIA_URL}}/assets/jquery-ui/jquery-ui.min.js"></script>
        <script src="{{MEDIA_URL}}/assets/knockout/knockout-2.2.1.js"></script>
        <!--
        <script src="{{MEDIA_URL}}/assets/knockout/knockout-2.3.0.js"></script>
        -->
        <script src="{{MEDIA_URL}}/assets/knockout/knockout-bindings.js"></script>
        <script src="{{MEDIA_URL}}/assets/knockout/knockout.mapping-latest.js"></script>
        <script src="{{MEDIA_URL}}/assets/jquery/jquery.pageguide.js"></script>
        <script src="{{MEDIA_URL}}/assets/highcharts/highcharts.js"></script>
        <script src="{{MEDIA_URL}}/assets/highcharts/highcharts-more.js"></script>
        <script src="{{MEDIA_URL}}/assets/underscore/underscore-min.js"></script>
        <script src="http://maps.google.com/maps/api/js?v=3.6&amp;sensor=false"></script>

        <script src="{{MEDIA_URL}}/assets/openlayers/OpenLayers-mp-min.js"></script>
        <script src="{{MEDIA_URL}}/assets/openlayers/arcgisrestidentify.js"></script>
        <!-- <script src="{{MEDIA_URL}}/assets/openlayers/OpenLayers.js"></script>
        <script src="{{MEDIA_URL}}/assets/openlayers/featureclick.js"></script> -->
        <script src="{{MEDIA_URL}}/ofr/js/OpenLayersWindowsPinchZoom.js"></script>

        <script src="{{MEDIA_URL}}/assets/simplelayerswitcher/simplelayerswitcher.js"></script>
        <script src="{{MEDIA_URL}}/assets/scalebar/scalebar.js"></script>
        <script src="{{MEDIA_URL}}/assets/bigscreen/bigscreen.js"></script>
        <script src="{{MEDIA_URL}}/assets/jquery/jquery.ui.touch-punch.min.js"></script>
        <script src="{{MEDIA_URL}}/assets/jquery/jquery.jscrollpane.min.js"></script>
        <script src="{{MEDIA_URL}}/assets/date/date.js"></script>

        <script>
            var app = {};
            {% if user.is_authenticated %}
            app.is_authenticated = true;
            app.session = "{{ session }}";
            {% else %}
            app.is_authenticated = false;
            {% endif %}
        </script>

        {% if SOCKET_URL %}
        <script src="{{SOCKET_URL}}/socket.io/socket.io.js"></script>
        <script>
            app.socketUrl = "{{ SOCKET_URL }}";
        </script>
        {% endif %}

        <!-- Check for Marine Planner Settings -->
        <script type="text/javascript">
            app.MPSettings = {
                project_name: "{{project_name}}",
                slug_name: "{{slug_name}}",
                latitude: parseFloat("{{latitude}}"),
                longitude: parseFloat("{{longitude}}"),
                zoom: parseFloat("{{zoom}}"),
                default_hash: "{{default_hash}}",
                min_zoom: parseFloat("{{min_zoom}}"),
                max_zoom: parseFloat("{{max_zoom}}"),
                project_logo: "{{project_logo}}",
                project_icon: "{{project_icon}}",
                project_home_page: "{{project_home_page}}",
                enable_drawing: "{{enable_drawing}}",
                bitly_registered_domain: "{{bitly_registered_domain}}",
                bitly_username: "{{bitly_username}}",
                bitly_api_key: "{{bitly_api_key}}"
            };
        </script>


        <script src="{{MEDIA_URL}}/js/fixtures.js"></script>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.6/proj4.js"></script> -->
        <script src="http://svn.osgeo.org/metacrs/proj4js/branches/proj4js-1.0/lib/proj4js-combined.js"></script>
        <script src="{{MEDIA_URL}}/js/map.js"></script>
        <script src="{{MEDIA_URL}}/js/state.js"></script>
        <script src="{{MEDIA_URL}}/js/models.js"></script>
        <script src="{{MEDIA_URL}}/js/surveyResults.js"></script>
        <script src="{{MEDIA_URL}}/js/bookmarks.js"></script>
        {% if user.is_authenticated %}
        <script src="{{MEDIA_URL}}/js/scenarios.js"></script>
        <!-- <script src="{{MEDIA_URL}}/js/reports.js"></script> -->
        <script src="{{MEDIA_URL}}/js/drawing.js"></script>
        {% endif %}
        <script src="{{MEDIA_URL}}/js/server.js"></script>
        <script src="{{MEDIA_URL}}/js/printing.js"></script>
        {% if user.is_staff %}
        <script src="{{MEDIA_URL}}/js/add-layer.js"></script>
        {% endif %}
        <script src="{{MEDIA_URL}}/js/app.js"></script>
        <script src="{{MEDIA_URL}}/js/pageguide.js"></script>
        <script src="{{MEDIA_URL}}/js/simple-statistics.js"></script>
        <script src="{{MEDIA_URL}}/js/clickAttributes.js"></script>

        <!--[if gt IE 8]><!-->
        <script src="{{MEDIA_URL}}/assets/jquery/jquery.mousewheel.min.js"></script>
        <!--<![endif]-->

        <script src="{{MEDIA_URL}}/assets/jquery/jquery.mCustomScrollbar.js"></script>

        <!-- google plus login -->
        <script type="text/javascript" src='//plus.google.com/js/client:plusone.js'>
        </script>
        <script type="text/javascript">

            var signInCallback = function (result) {
              if (result.error) {
                  // console.log('An error happened:', result.error);
              } else if (result['g-oauth-window']) {
                  $('#code').attr('value', result.code);
                  $('#at').attr('value', result.access_token);
                  $('#google-plus').submit();
              } else {
                gapi.auth.signOut();
              }
            };
        </script>
        <script>
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        app.csrftoken = getCookie('csrftoken');
        </script>


        <script>
        !
        function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (!d.getElementById(id)) {
                js = d.createElement(s);
                js.id = id;
                js.src = "//platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);
            }
        }(document, "script", "twitter-wjs");
        </script>


    </body>

</html>
